
\documentclass[fleqn,12pt]{article}

\usepackage[margin=15mm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[bulgarian]{babel}
\usepackage[unicode]{hyperref}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{enumitem, hyperref}
\usepackage{upgreek}
\usepackage{indentfirst}

\usepackage{amsmath}
\DeclareMathOperator{\cotg}{cotg}
\DeclareMathOperator{\LCS}{LCS}
\DeclareMathOperator{\longer}{longer}

\title{Тема 10\\ Бази от данни. Нормални форми.}

\author{v0.1}
\date{24 юни 2021}

\begin{document}

\maketitle
\tableofcontents
\pagebreak


\section{Проектиране схемите на релационните бази от данни}

Транслацията на даннов модел (напр. \textbf{същност-връзка}) на база от данни до съвкупност от релации, над чиито атрибути са дефинирани зависимости, се нарича проектиране на схема на релационна база от данни.
Важни цели на този процес са да запази цялостта на данните, както и да нормализира получените релации.
\bigbreak
Нормализацията на релационна база от данни е процесът на реструктуриране на релациите и зависимостите на техните атрибути в нормални форми, които целят \textbf{минимизация на дублирането на данните}, както и запазването на тяхната \textbf{цялост}.
Възможни начини за извършването ѝ са синтез, т.е. създаване на нов релационен дизайн, и декомпозиция на вече съществуващ такъв (по-често използван).

\section{Функционални зависимости}

\textbf{\textit{Деф}} - Нека $R(A_1, \dots, A_n), n \in \mathbb{N}$ е релация.
Функционална зависимост (ФЗ) за релацията $R$ наричаме твърдение от вида $A_i \rightarrow A_j$, където $A_i, A_j$ са множества атрибути на $R$, при което $\forall t, u \in R$ е изпълнено, че ако $t$ и $u$ съвпадат по атрибутите $A_i$ на $R$, то те съвпадат и по атрибутите $A_j$ на $R$.
Четем $A_i$ еднозначно определя $A_j$.
\bigbreak
\textbf{\textit{Правило за разделяне}} - Можем да разделяме атрибутите от дясната страна на ФЗ, така че само един атрибут да се появява от дясно за всяка ФЗ.
Например ФЗ $A_1, A_2 \rightarrow B_1, B_2$ може да се раздели на $A_1, A_2 \rightarrow B_1$ и $A_1, A_2 \rightarrow B_2$.
\bigbreak
\textbf{\textit{Правило за комбиниране}} - Можем да комбинираме множество от ФЗ с едни и същи леви страни до една ФЗ с комбинирани десни страни на първоначалните ФЗ.
Например ФЗ $A_1, A_2 \rightarrow B_1$ и $A_1, A_2 \rightarrow B_2$ можем да комбинираме в $A_1, A_2 \rightarrow B_1, B_2$.
\bigbreak
\textbf{\textit{Заб}} - Правилата за разделяне и комбиниране са приложими само за десните страни на ФЗ.
\bigbreak
\textbf{\textit{Деф}} - Нека $A_1, \dots, A_n \rightarrow B_1, \dots B_m, n, m \in \mathbb{N}$ е ФЗ.
Тогава казваме, че тя е \textbf{тривиална ФЗ} ако $\{B_1, \dots, B_m\} \subseteq \{A_1, \dots, A_n\}$.
\bigbreak
\textbf{\textit{Деф}} - Всяка ФЗ, която не е тривиална се нарича \textbf{нетривиална}.

\section{Ключове}

\textbf{\textit{Деф}} - Множество от един или повече атрибути $\{A_1, \dots, A_n\}$ на дадена релация $R$ наричаме ключ на $R$ ако:
\begin{enumerate}
    \item $\{A_1, \dots, A_n\}$ функционално определя всички останали атрибути на $R$.
    \item $\{A_1, \dots, A_n\}$ е минимално, т.е. не съществува строго подмножество на $\{A_1, \dots, A_n\}$, за което да е изпълнено условие 1.
\end{enumerate}
\bigbreak
\textit{\textbf{Пример} - Нека $R(A_1, A_2, B_1, B_2)$ е релация и $A_1, A_2 \rightarrow B_1$ и $A_1, A_2 \rightarrow B_2$ са ФЗ.
Тогава имаме, че $A_1, A_2 \rightarrow A_1, A_2, B_1, B_2$ и следователно $\{A_1, A_2\}$ е ключ на $R$.}
\bigbreak
\textbf{\textit{Заб}} - За дадена релация може да съществуват повече от 1 ключа.
Те се наричат \textbf{кандидат-ключове}.
За всяка релация се избира един ключ, който се нарича \textbf{първичен ключ}.
\bigbreak
\textbf{\textit{Деф}} - Нека $R$ е релация и $K$ е ключ на $R$. Множество от атрибути $A: K \subseteq A$ се нарича \textbf{суперключ} на $R$.

\section{Покриетие на ФЗ}

От множеството от ФЗ, които са в сила в релация $R$, можем да определим кандидат ключовете за дадена релация.
Това се прави чрез намирането на покритието на всички атрибути и комбинация от атрибути за релацията $R$.
\bigbreak
\textbf{\textit{Деф}} - Нека $R(A_1, \dots, A_n), n \in \mathbb{N}$ е релация, $S$ е множеството от функционални зависимости в сила за $R$ и $T = \{B_1, \dots, B_m\} \subseteq \{A_1, \dots, A_n\}$.
Покритие на множеството от атрибути $T$ наричаме множеството $T^{+} \subseteq \{A_1, \dots, A_n\}$, такова че $\forall A_i \in T^{+} \exists$ ФЗ $B_1, \dots, B_m \rightarrow A_i$, която може да бъде изведена от $S$.
\bigbreak
\textbf{\textit{Алгоритъмът за намиране на покритие}} на множество от атрибути $T = \{B_1, \dots, B_m\}$ за релацията $R(A_1, \dots, A_n)$ и множество от ФЗ $S$ е следния:
\begin{enumerate}
    \item Нека $T^{+} := T$.
    \item $\forall$ ФЗ от вида $C_1, \dots, C_k \rightarrow D_1, \dots, D_p$, такива че $\{C_1, \dots, C_k\} \subseteq T^{+}$ и $\{D_1, \dots, D_p\} \nsubseteq T^{+}$ обнoвяваме $T^{+} := T^{+} \cup \{D_1, \dots, D_p\}$.
    \item Повтаряме стъпка 2. до момента, в който вече не можем да добавяме нови атрибути в $T^{+}$.
    Понеже множеството $T^{+}$ може само да нараства, а броят на атрибутите е краен, то след краен брой итерации ще стигнем до момент, в който няма да можем да добавим повече атрибути в $T^{+}$ и следователно алгоритъмът ще приключи.
    \item Множеството $T^{+}$ е търсеното покритие.
\end{enumerate}

\subsection{Аксиоми на Армстронг}

\textbf{\textit{Аксиомите на Армстронг}} са правила, по които можем да генерираме нови ФЗ, които също са правила в съответната релация.
Нека $R$ е релация и $T$ е множество от атрибути в $R$.
Тогава основните аксиоми на Армстронг са:
\begin{itemize}
    \item \textit{Рефлексивност} - Ако $U \subseteq T$, то $T \rightarrow U$.
    \item \textit{Умножение} - Ако $A$ е атрибут в $R$, $U \subseteq R$ и $T \rightarrow U$, то $T \cup \{A\} \rightarrow U \cup \{A\}$.
    \item \textit{Транзитивност} - Ако $U, P \subseteq R, T \rightarrow U$ и $U \rightarrow P$ следва, че $T \rightarrow P$.
\end{itemize}

\section{Ограничения}

\textbf{\textit{Деф}} - Ограниченията са механизъм за налагане на цялост върху данните чрез дефиниране на правила, на които трябва да отговарят стойностите на конкретни атрибути.
Накратко не позволяват въвеждането на невалидни данни.
Основните ограничения са:
\begin{itemize}
    \item \textit{Уникалност на множество от атрибути} - два кортежа не могат да имат едни и същи стойности на атрибутите от множеството.
    По дефиниция първичните ключове са уникални.
    В \textit{SQL} обичайно се имплементира чрез ключовите думи \textit{UNIQUE} и \textit{PRIMARY\_KEY}.
    \item \textit{Задаване на домейн от възможни стойности на множество от атрибути} - имплементират се чрез предикати.
    В \textit{SQL} обичайно се имплементира посредством ключовите думи \textit{CHECK} и \textit{NOT\_NULL}.
    \item \textit{Външен ключ} - представлява множество от атрибути, такова, че за всяка ненулева стойност на атрибут, който е външен ключ, трябва да съществува ключов атрибут от друга релация, който да съдържа същата стойност.
    В \textit{SQL} обичайно се имплементира чрез ключовата дума \textit{FOREIGN\_KEY}.
\end{itemize}

\section{Аномалии}

При проектиране на релационните схеми, могат да бъдат получени следните аномалии:
\begin{itemize}
    \item \textit{Излишества} - повторение на информация без това да бъде необходимо.
    \item \textit{Аномалии при обновяване} - получава се когато при промяна на данни в един кортеж не се обновят свързаните с него кортежи и се стигне неконсистентна информация в следствие на прекъсната заявка.
    \item \textit{Аномалии при добавяне} - получава се когато се опитваме да добавим информация, но тя не може да бъде добавена освен по половинчат начин. Случва се при релации с транзитивни ФЗ.
    \item \textit{Аномалии при изтриване} - получава се когато се опитаме да изтрием информация, но това не може да се случи без премахването на друга важна информация. Случва се при релации с транзитивни ФЗ.
\end{itemize}

\subsection{Избягване на излишествата}

Начин да избегнем излишествата е чрез декомпозиране на релацията. Декомпозирането е равносилно на разделяне на атрибтутите ѝ в няколко нови релации.
\bigbreak
\textit{Пример - Нека $R(A_1, A_2, B_1, B_2)$ е релация. Тогава можем да композираме релацията $R$ до две релации $R_1(A_1, A_2)$ и $R_2(B_1, B_2)$, такива че:
\begin{itemize}
    \item множеството от атрибутите на $R$, да бъде равно на обединението от множествата на атрибутите на $R_1$ и $R_2$,
    \item кортежите в $R_1$ са проекция по атрибутите $A_1$ и $A_2$ на релацията $R$,
    \item кортежите в $R_2$ са проекция по атрибутите $B_1$ и $B_2$ на релацията $R$, 
\end{itemize}
където проекция по атрибути означава, че в новополучените релации взимаме само стойностите на кортежите на $R$ в тези атрибути.
Интересно е, че при проекция може да се получат два или повече еднакви кортежа от $R$.
Тогава щом $R_1$ и $R_2$ са релации, т.е. множества, значи остава само един от тези кортежи и по този начин се премахва дубликацията на информация.
}

\section{Нормални форми}

\textbf{\textit{Първа нормална форма (1НФ)}} - Казваме, че релацията $R$ се намира в 1НФ, когато всички компоненти в кортежите на $R$ имат атомарен домейн.

\textbf{\textit{Втора нормална форма (2НФ)}} - Казваме, че релацията $R$ се намира в 2НФ, когато тя се намира в 1НФ и всеки непървичен атрибут е функционално зависим от атрибутите на първичния ключ, но не и от негово подмножество.

\textbf{\textit{Трета нормална форма (3НФ)}} - Казваме, че релацията $R$ се намира в 3НФ, когато тя се намира в 2НФ и за всяка нетривиална ФЗ, която е в сила за $R$, или лявата част е суперключ за $R$, или дясната е подмножество на ключ на $R$, т.е. няма транзитивни ФЗ.

\textbf{\textit{Нормална форма на Бойс-Код (НФБК)}} - Казваме, че една релация $R$ се намира в НФБК, когато тя се намира в 3НФ и за всяка нетривиална ФЗ, която е в сила в $R$ е изпълнено, че лявата ѝ част е суперключ на $R$.

\textbf{\textit{Твърд.}} - Щом една релация $R$ се намира в НФБК, то в нея не могат да възникнат аномалии свързани с ФЗ.

\section{Съединение без загуба}

\textbf{\textit{Деф}} - Нека $R(A_1, \dots, A_n), n \in \mathbb{N}$ е релация и $R$ се декомпозира на релациите $R_1, \dots, R_m, m \in \mathbb{N}$.
Казваме, че декомпозицията е \textbf{със съединение без загуба}, ако $R = R_1 \bowtie \dots \bowtie R_m$, където $\bowtie$ е релацията eстествено съединение (natural join) от релационната алгебра.
\bigbreak
\textbf{\textit{Тв}} - Декомпозицията на релацията $R(A_1, \dots, A_n)$ на 2 релации $S(B_1, \dots, B_m)$ и $T(C_1, \dots, C_k)$ за $n, m, k \in \mathbb{N}$ е съединение без загуба $\iff$ за $R$ е изпълнена поне една от следните функционални зависимости $\{B_1, \dots, B_m\} \cap \{C_1, \dots, C_k\} \rightarrow \{B_1, \dots, B_m\}$ или $\{B_1, \dots, B_m\} \cap \{C_1, \dots, C_k\} \rightarrow \{C_1, \dots, C_k\}$.
\bigbreak
\textbf{\textit{Деф}} - Нека $R(A_1, \dots, A_n), n \in \mathbb{N}$ е релация, за която множеството от ФЗ е $F$.
Нека $R$ се декомпозира на релациите $R_1, \dots, R_m, m \in \mathbb{N}$, чиито множества от ФЗ са съответно $F_1, \dots, F_m$, като те са съответно проекции на $F$ върху $R_1, \dots, R_m$.
Казваме, че декомпозицията е \textbf{със съединение без загуба на функционалните зависимости} когато $F_1 \cup \dots \cup F_m = F$.
\bigbreak

Нека $R$ е релация в 3НФ с атрибути $\{A_1, \dots, A_n, B_1, \dots, B_m, C_1, \dots, C_k\}$, $A_1, \dots, A_n \rightarrow B_1, \dots, B_m$, $n, m, k \in \mathbb{N}$ е нетривиална ФЗ и $\{A_1, \dots, A_n\}$ не е суперключ.
\textbf{Алгоритъмът за свеждане на релацията $R$ от 3НФ в НФБК} е:
\begin{enumerate}
    \item Откриваме една ФЗ, която нарушава НФБК, т.е. не е със суперключ от лявата си страна. В случая такава е $A_1, \dots, A_n \rightarrow B_1, \dots, B_m$.
    \item Създаваме релация с атрибутите на ФЗ, която нарушава НФБК, т.е. в случая създаваме релацията $R_1(A_1, \dots, A_n, B_1, \dots, B_m)$.
    \item Създаваме релация с атрибутите от лявата страна на ФЗ и всички останали, които не участват във ФЗ. В случая това е релацията $R_2(A_1, \dots, A_n, C_1 \dots C_k)$.
\end{enumerate}

\textbf{\textit{Твърд.}} - Декомпозицията получена от алгоритъма за свеждане на релация от 3НФ до НФБК е съединение без загуба.
Следователно в примера $R = R_1 \bowtie R_2$.

\section{Многозначни зависимости}

\textbf{\textit{Деф за многозначна функционална зависимост (МФЗ)}} - Нека $R$ е релация с множество от атрибути $\{A_1, \dots, A_n, B_1, \dots, B_m, C_1 \dots, C_k\}, n, m, k \in \mathbb{N}$.
Казваме, че $A_1, \dots, A_n$ определя многозначно $C_1, \dots, C_k$ $\iff$ за всеки два кортежа $U, T \in R$, съвпадащи по атрибутите $A_1, \dots, A_n$, $\exists$ кортеж $V \in R$, такъв че съвпада с кортежите $U$ и $T$ по атрибутите $A_1, \dots, A_n$, с кортежа $U$ по атрибутите $B_1, \dots, B_m$ и с кортежа $T$ по атрибутите $C_1, \dots, C_k$.
Т.е. ако между два случайни кортежа с еднакви стойности по $A_1, \dots, A_n$ разменим стойностите на атрибутите $C_1, \dots, C_k$ ние получаваме същата релация.
Означаваме като $A_1, \dots, A_n \twoheadrightarrow C_1, \dots, C_k$.
\bigbreak
Пример за релация където $C \twoheadrightarrow B$ е следната:

\begin{center}
\begin{tabular}{ |c|c|c| } 
    \hline
    A & B & C \\
    \hline
    a1 & b2 & c3 \\ 
    a1 & b3 & c2 \\ 
    a1 & b2 & c2 \\ 
    a3 & b2 & c1 \\
    a3 & b2 & c3 \\
    \hline
\end{tabular}
\end{center}

\textbf{\textit{Деф}} - MФЗ $A_1, \dots, A_n \twoheadrightarrow B_1, \dots B_m$ в релацията $R$ наричаме тривиална когато $\{B_1, \dots B_m\} \subseteq \{A_1, \dots, A_n\}$.

\textbf{\textit{Правило за транзитивност}} - Ако $A \twoheadrightarrow B$ и $B \twoheadrightarrow C$, то $A \twoheadrightarrow C$.

\textbf{\textit{Нови правила}} - Всяка ФЗ е МФЗ, т.е. ако $A \rightarrow B$, то $A \twoheadrightarrow B$. (При условие, че размерът на домейна на B е 1)

\textbf{\textit{Заб}} - Правилото за разделяне и комбиниране не е в сила за МФЗ, т.е. ако $A \twoheadrightarrow B_1, B_2$, не значи, че $A \twoheadrightarrow B_1$ и $A \twoheadrightarrow B_2$ и обратното.

\section{Четвърта нормална форма}

\textbf{\textit{Деф}} - Казваме, че релацията $R$ е в четвърта нормална форма (4НФ), ако тя е в НФБК и за всяка нетривиална МФЗ $A \twoheadrightarrow B$, която е в сила за релацията $R$ и за която $А$ и $B$ са множества от атрибути на $R$, е изпълнено, че $A$ е суперключ на релацията $R$.
\bigbreak
Аномалиите, които се получават при МФЗ, могат да бъдат предотвратени чрез декомпозиция в 4НФ.
В 4НФ нетривиалните МФЗ, които нарушават 4НФ, се елиминират подобно на нетривиалните ФЗ при НФБК.
В резултат на това декомпозираната релация няма да има излишества.
\bigbreak
Алгоритъмът за декомпозиране от НФБК в 4НФ е аналогичен на този за декомпозиране в НФБК, с разликата, че се декомпозира по МФЗ.
Когато декомпозираме следвайки този алгоритъм е гарантирано, че декомпозицията е съединение без загуба.

\end{document}
