
\documentclass[fleqn,12pt]{article}

\usepackage[margin=15mm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[bulgarian]{babel}
\usepackage[unicode]{hyperref}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{enumitem, hyperref}
\usepackage{upgreek}
\usepackage{indentfirst}

\usepackage{amsmath}
\DeclareMathOperator{\cotg}{cotg}
\DeclareMathOperator{\LCS}{LCS}
\DeclareMathOperator{\longer}{longer}

\title{Бази от данни. Нормални форми.}

\author{v0.1}
\date{24 юни 2021}

\begin{document}

\maketitle
\tableofcontents
\pagebreak


\section{Нормални форми}
\subsection{Проектиране схемите на релационните бази от данни}

Транслацията на даннов модел (напр. \textbf{същност-връзка}) на база от данни до съвкупност от релации, над чиито атрибути са дефинирани зависимости, се нарича проектиране на схема на релационна база от данни.
Важни цели на този процес са да запази цялостта на данните, както и да нормализира получените релации.
\bigbreak
Нормализацията на релационна база от данни е процесът на реструктуриране на релациите и зависимостите на техните атрибути в нормални форми, които целят \textbf{минимизация на дублирането на данните}, както и запазването на тяхната \textbf{цялост}.
Възможни начини за извършването ѝ са синтез, т.е. създаване на нов релационен дизайн, и декомпозиция на вече съществуващ такъв (по-често използван).

\subsection{Функционални зависимости}

\textbf{\textit{Деф}} - Нека $R(A_1, \dots, A_n), n \in \mathbb{N}$ е релация.
Функционална зависимост (ФЗ) за релацията $R$ наричаме твърдение от вида $A_i \rightarrow A_j$, където $A_i, A_j$ са атрибути на $R$, при което $\forall t, u \in R$ е изпълнено, че ако $t$ и $u$ съвпадат по атрибута $A_i$ на $R$, то те съвпадат и по атрибута $A_j$ на $R$.
Четем $A_i$ еднозначно определя $A_j$.
\bigbreak
\textbf{\textit{Правило за разделяне}} - Можем да разделяме атрибутите от дясната страна на ФЗ, така че само един атрибут да се появява от дясно за всяка ФЗ.
Например ФЗ $A_1, A_2 \rightarrow B_1, B_2$ може да се раздели на $A_1, A_2 \rightarrow B_1$ и $A_1, A_2 \rightarrow B_2$.
\bigbreak
\textbf{\textit{Правило за комбиниране}} - Можем да комбинираме множество от ФЗ с едни и същи леви страни до една ФЗ с комбинирани десни страни на първоначалните ФЗ.
Например ФЗ $A_1, A_2 \rightarrow B_1$ и $A_1, A_2 \rightarrow B_2$ можем да комбинираме в $A_1, A_2 \rightarrow B_1$ и $A_1, A_2 \rightarrow B_1, B_2$.
\bigbreak
\textbf{\textit{Заб}} - Правилата за разделяне и комбиниране са приложими само за десните страни на ФЗ.
\bigbreak
\textbf{\textit{Деф}} - Нека $A_1, \dots, A_n \rightarrow B_1, \dots B_m, n, m \in \mathbb{N}$ е ФЗ.
Тогава казваме, че тя е \textbf{тривиална ФЗ} ако $\{B_1, \dots, B_m\} \subseteq \{A_1, \dots, A_n\}$.
\bigbreak
\textbf{\textit{Деф}} - Всяка ФЗ, която не е тривиална се нарича нетривиална.

\subsection{Ключове}

\textbf{\textit{Деф}} - Множество от един или повече атрибути $\{A_1, \dots, A_n\}$ на дадена релация $R$ наричаме ключ на $R$ ако:
\begin{enumerate}
    \item $\{A_1, \dots, A_n\}$ функционално определя всички останали атрибути на $R$.
    \item $\{A_1, \dots, A_n\}$ е минимално, т.е. не съществува подмножество на $\{A_1, \dots, A_n\}$, за което да е изпълнено условие 1.
\end{enumerate}
\bigbreak
\textit{\textbf{Пример} - Нека $R(A_1, A_2, B_1, B_2)$ е релация и $A_1, A_2 \rightarrow B_1$ и $A_1, A_2 \rightarrow B_2$ са ФЗ.
Тогава имаме, че $A_1, A_2 \rightarrow A_1, A_2, B_1, B_2$ и следователно $\{A_1, A_2\}$ е ключ на $R$.}
\bigbreak
\textbf{\textit{Заб}} - За дадена релация може да съществуват повече от 1 ключа.
Те се наричат \textbf{кандидат-ключове}.
За всяка релация се избира един ключ, който се нарича \textbf{първичен ключ}.
\bigbreak
\textbf{\textit{Деф}} - Нека $R$ е релация и $K$ е ключ на $R$. Множество от атрибути $A: K \subseteq A$ се нарича \textbf{суперключ} на $R$.

\subsubsection{Покриетие на ФЗ}

От множеството от ФЗ, които са в сила в релация $R$, можем да определим кандидат ключовете за дадена релация.
Това се прави чрез намирането на покритието на всички атрибути и комбинация от атрибути за релацията $R$.
\bigbreak
\textbf{\textit{Деф}} - Нека $R(A_1, \dots, A_n), n \in \mathbb{N}$ е релация, $S$ е множеството от функционални зависимости в сила за $R$ и $T = \{B_1, \dots, B_m\} \subseteq \{A_1, \dots, A_n\}$.
Покритие на множеството от атрибути $T$ наричаме множеството $T^{+} \subseteq \{A_1, \dots, A_n\}$, такова че $\forall A_i \in T^{+} \exists$ ФЗ $B_1, \dots, B_m \rightarrow A_i$, която може да бъде изведена от $S$.
\bigbreak
\textbf{\textit{Алгоритъмът за намиране на покритие}} на множество от атрибути $T = \{B_1, \dots, B_m\}$ за релацията $R(A_1, \dots, A_n)$ и множество от ФЗ $S$ е следния:
\begin{enumerate}
    \item Нека $T^{+} := T$.
    \item $\forall$ ФЗ от вида $C_1, \dots, C_k \rightarrow D_1, \dots, D_p$, такива че $\{C_1, \dots, C_k\} \subseteq T^{+}$ и $\{D_1, \dots, D_p\} \cap T^{+} \neq \emptyset$ обнявавме $T^{+} := T^{+} \cup \{D_1, \dots, D_p\}$.
    \item Повтаряме стъпка 2. до момента, в който вече не можем да добавяме нови атрибути в $T^{+}$.
    Понеже множеството $T^{+}$ може само да нараства, а броят на атрибутите е краен, то след краен брой итерации ще стигнем до момент, в който няма да можем да добавим повече атрибути в $T^{+}$ и следователно алгоритъмът ще приключи.
    \item Множеството $T^{+}$ е търсеното покритие.
\end{enumerate}

\subsection{Аксиоми на Армстронг}

\textbf{\textit{Аксиомите на Армстронг}} са правила, по които можем да генерираме нови ФЗ, които също са правила в съответната релация.
Нека $R$ е релация и $T$ е множество от атрибути в $R$.
Тогава основните аксиоми на Армстронг са:
\begin{itemize}
    \item \textit{Рефлексивност} - Ако $U \subseteq T$, то $T \rightarrow U$.
    \item \textit{Умножение} - Ако $A$ е атрибут в $R$, $U \subseteq R$ и $T \rightarrow U$, то $T \cup \{A\} \rightarrow U \cup \{A\}$.
    \item \textit{Транзитивност} - Ако $U, P \subseteq R, T \rightarrow U$ и $U \rightarrow P$ следва, че $T \rightarrow P$.
\end{itemize}

\subsection{Ограничения}

\textbf{\textit{Деф}} - Ограниченията са механизъм за налагане на цялост върху данните чрез дефиниране на правила, на които трябва да отговарят стойностите на конкретни атрибути.
Накратко не позволяват въвеждането на невалидни данни.
Основните ограничения са:
\begin{itemize}
    \item \textit{Уникалност на множество от атрибути} - два кортежа не могат да имат едни и същи стойности на атрибутите от множеството.
    По дефиниция първичните ключове са уникални.
    В \textit{SQL} обичайно се имплементира чрез ключовите думи \textit{UNIQUE} и \textit{PRIMARY\_KEY}.
    \item \textit{Задаване на домейн от възможни стойности на множество от атрибути} - имплементират се чрез предикати.
    В \textit{SQL} обичайно се имплементира посредством ключовите думи \textit{CHECK} и \textit{NOT\_NULL}.
    \item \textit{Външен ключ} - представлява множество от атрибути, такова, че за всяка ненулева стойност на атрибут, който е външен ключ, трябва да съществува ключов атрибут от друга релация, който да съдържа същата стойност.
    В \textit{SQL} обичайно се имплементира чрез ключовата дума \textit{FOREIGN\_KEY}.
\end{itemize}

\subsection{Аномалии}

При проектиране на релационните схеми, могат да бъдат получени следните аномалии:
\begin{itemize}
    \item \textit{Излишества} - повторение на информация без това да бъде необходимо.
    \item \textit{Аномалии при обновяване} - получава се когато при промяна на данни в един кортеж не се обновят свързаните с него кортежи и се стигне неконсистентна информация в следствие на прекъсната заявка.
    \item \textit{Аномалии при добавяне} - получава се когато се опитваме да добавим информация, но тя не може да бъде добавена освен по половинчат начин. Случва се при релации с транзитивни ФЗ.
    \item \textit{Аномалии при изтриване} - получава се когато се опитаме да изтрием информация, но това не може да се случи без премахването на друга важна информация. Случва се при релации с транзитивни ФЗ.
\end{itemize}

\subsubsection{Избягване на излишествата}

Начин да избегнем излишествата е чрез декомпозиране на релацията. Декомпозирането е равносилно на разделяне на атрибтутите ѝ в няколко нови релации.
\bigbreak
\textit{Пример - Нека $R(A_1, A_2, B_1, B_2)$ е релация. Тогава можем да композираме релацията $R$ до две релации $R_1(A_1, A_2)$ и $R_2(B_1, B_2)$, такива че:
\begin{itemize}
    \item множеството от атрибутите на $R$, да бъде равно на обединението от множествата на атрибутите на $R_1$ и $R_2$,
    \item кортежите в $R_1$ са проекция по атрибутите $A_1$ и $A_2$ на релацията $R$,
    \item кортежите в $R_2$ са проекция по атрибутите $B_1$ и $B_2$ на релацията $R$, 
\end{itemize}
където проекция по атрибути означава означава, че в новополучените релации взимаме само стойностите на кортежите на $R$ в тези атрибути.
Интересно е, че при проекция може да се получат два или повече еднакви кортежа от $R$.
Тогава щом $R_1$ и $R_2$ са релации, т.е. множества, значи остава само един от тези кортежи и по този начин се премахва дупликацията на информация.
}

\subsection{Нормални форми}

\textbf{\textit{Първа нормална форма (1НФ)}} - Казваме, че релацията $R$ се намира в 1НФ, когато всички компоненти в кортежите на $R$ имат атомарна стойноста.

\textbf{\textit{Втора нормална форма (2НФ)}} - Казваме, че релацията $R$ се намира в 2НФ, когато тя се намира в 1НФ и всеки атрибут е функционално зависим от атрибутите на първичния ключ, но не и от негово подмножество.

\textbf{\textit{Трета нормална форма (3НФ)}} - Казваме, че релацията $R$ се намира в 3НФ, когато тя се намира в 2НФ и за всяка нетривиална ФЗ, която е в сила за $R$, или лявата част е суперключ за $R$, или дясната е подмножество на ключ на $R$, т.е. няма транзитивни ФЗ.

\textbf{\textit{Нормална форма на Бойс-Код (НФБК)}} - Казваме, че една релация $R$ се намира в НФБК, когато тя се намира в 3НФ и за всяка нетривиална ФЗ, която е в сила в $R$ е изпълнено, че лявата ѝ част е суперключ на $R$.

\textbf{\textit{Твърд.}} - Щом една релация $R$ се намира в НФБК, то в нея не могат да възникнат аномалии свързани с ФЗ.

\textbf{\textit{Твърд.}} - Ако следваме алгоритъма за получаване на НФБК от 3НФ, то оригиналната релация може да бъде точно възстановена чрез съединяване на проектираните кортежи от новополучените релации по всички възможни начини.
В противен случай това не е възможно.

\subsection{Многозначни зависимости}

\subsection{Аксиоми на функционалните и многозначните зависимости}

\subsection{Съединение без загуба}

\subsection{Четвърта нормална форма}

\end{document}
